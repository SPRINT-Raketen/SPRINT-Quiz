<!DOCTYPE html>

<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Quiz Page</title>
        <link rel = "stylesheet" href = "css/quizStyle.css">
        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

        <script src="js/script.js"></script>

        <!-- Bootstrap -->
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/style.css" rel="stylesheet">

        <script>
            // Link zum JSON-Objekt nach Spezifikation des API. Vorläufig statisch, später irgendwie mit API
            var json_url = 'https://raw.githubusercontent.com/SPRINT-Raketen/SPRINT-Quiz/b587a2041e395ad5571dd85c6092ac55e9846154/project/frontend/src/main/officialJSONdummy.json';
          
            var json_obj_global; //Zwischenspeicher um JSON von getJSON() an parseJSON () zu übergeben
            var parsedJSON_global; //Zwischenspeicher um parsedJSON von parseJSON () an distributeJSONcontent ()  zu übergeben

            //Variablen zum Zwischenspeichern der Werte aus JSON
            var questionId;
            var levelId=0; //0=Startwert. So wird zu Quizstart eine Frage mit Level 0 requestet. Später wird levelId der aktuellen Frage +1 requested
            var value;    
            var levelText;
            var subject="Informatik"; //Eigentlich sollte das über die Einladung gemacht werden. Stand 22.03
            var subjectId; 
            var feedback_a;
            var feedback_b;
            var feedback_c;
            var feedback_d; 


            //generiert Anfrage an API mit Parametern Level, subject etc.
            function buildAPIrequest (){
                var baseURL="GET http://localhost:8081/sprintquiz/api/questions/question.php";
                var endpointLevel;
                var endpointSubject;

                endpointLevel=levelId;
                endpointSubject=subject;

                //request mergen
                json_url=//Zusammensetzen aus baseURL und den endpoints. falls endpoints!=null, müssen noch "?" rein. Spielt Reihenfolge der Parameter eine Rolle?
            };

            //holt JSON-Objekt ab (vorläufig auf GitHub, später beim API)
            function getJSON (){
                fetch(json_url)
                .then(response => {
                    if (response.status === 200) {    // okay
                        const json_obj = response.json();   // consume json, only once possible!
                        console.log("json to var - return now");
                        return json_obj;    // return consumed json to second .then() 
                    } else {    // nok, so print error
                        alert(response.status.toString() + ": " + response.statusText);
                    }
                })

                //Diesen Teil will ich eigentlich in parseJSON und distributeJSONcontent auslagern, klappt aber noch nicht.
                .then(myJson => { // lambda to manage consumed jso
                    var parsedJSON = myJson; 
                    //Ich lese aus der API-Spezifikation von oben nach unten, egal ob's Variablen oder html-Inhalte sind
                    questionId                                          =   parsedJSON.id;
                    levelId                                             =   parsedJSON.level.id;
                    document.getElementById("level").innerHTML          =   levelId;
                    value                                               =   parsedJSON.level.value;
                    levelText                                           =   parsedJSON.level.text;
                    subjectId                                           =   parsedJSON.subject.id;
                    document.getElementById("subject").innerHTML        =   parsedJSON.subject.text;
                    document.getElementById("question_text").innerHTML  =   parsedJSON.question;
                    document.getElementById("answer_a").innerHTML       =   parsedJSON.answers[0].text;
                    feedback_a                                          =   parsedJSON.answers[0].Feedback;
                    document.getElementById("answer_b").innerHTML       =   parsedJSON.answers[1].text;
                    feedback_b                                          =   parsedJSON.answers[1].Feedback;
                    document.getElementById("answer_c").innerHTML       =   parsedJSON.answers[2].text;
                    feedback_c                                          =   parsedJSON.answers[2].Feedback;
                    document.getElementById("answer_d").innerHTML       =   parsedJSON.answers[3].text;
                    feedback_d                                          =   parsedJSON.answers[3].Feedback;
                })
            }

            //JSON parsen
            function parseJSON (json_obj){
                document.getElementById("answer3").innerHTML    = "parseJSON: VOR parse"; //nur zur Kontrolle
                var parsedJSON_lokal = JSON.parse(json_obj);
                document.getElementById("answer4").innerHTML    = "parseJSON: NACH parse"; //nur zur Kontrolle
                return parsedJSON_lokal;
            }

            //schnippelt die eckigen Klammern aus JSON weg
            function cleanJSON (parsedJSON) {}
        
            //JSON-Inhalte auf verschiedene Felder verteilen
            function distributeJSONcontent (parsedJSON){
                    //Ich lese aus der API-Spezifikation von oben nach unten, egal ob's Variablen oder html-Inhalte sind
                    var questionId                                      =   parsedJSON.id;
                    var levelId                                         =   parsedJSON.level.id;
                    document.getElementById("level").innerHTML          =   levelId;
                    var value                                           =   parsedJSON.level.value;
                    var levelText                                       =   parsedJSON.level.text;
                    var subjectId                                       =   parsedJSON.subject.id;
                    document.getElementById("subject").innerHTML        =   parsedJSON.subject.text;
                    document.getElementById("question_text").innerHTML  =   parsedJSON.question;
                    document.getElementById("answer_a").innerHTML       =   parsedJSON.answers[0].text;
                    var feedback_a                                      =   parsedJSON.answers[0].Feedback;
                    document.getElementById("answer_b").innerHTML       =   parsedJSON.answers[1].text;
                    var feedback_b                                      =   parsedJSON.answers[1].Feedback;
                    document.getElementById("answer_c").innerHTML       =   parsedJSON.answers[2].text;
                    var feedback_c                                      =   parsedJSON.answers[2].Feedback;
                    document.getElementById("answer_d").innerHTML       =   parsedJSON.answers[3].text;
                    var feedback_d                                      =   parsedJSON.answers[3].Feedback;
            }

            //alle Schritte zusammen ausführen (neue Frage requesten, JSON aufnehmen, Inhalte anzeigen)
            function showNewQuestion (){
                //buildAPIrequest ();
                json_obj_global= getJSON();
                //parsedJSON_global=parseJSON (json_obj_global);
                //parsedJSON_global=cleanJSON (parsedJSON_global);
                //distributeJSONcontent(parsedJSON_global);
            }
        </script>
        
        <script src="js/quiz.js"></script>
    </head>

    <body>
        <!--Zeile mit Quiz beenden-->
        <div class="row">
            <div class="col-md-4"></div>
            <div class="col-md-6"></div>
            <div class="col-md-2">
                <section id="result" style="display: none">
                    <button class="btn btn-dark"><a href = "results.html" title ="Anzeige der aktuellen Punkte">Quiz beenden</a></button>
                </section>
            </div>
        </div>
        <br>
        <br>
        <div id="image" style="display:block">
            <img src = "millionen-quiz.png" width = "200" height="191" alt = "SPRINT-Quiz">
        </div>
        <!--Section mit Frage und Antworten-->
        <section id="quiz1" style="display: none">
            <form id="quiz" name="quiz" method="" action="">
                <div class="row">
                    <div class="col-md-1"></div>
                    <div class="col-md-4">
                        <h4 class="d-inline p-2 bg-warning text-white">Frage <span id="qno">0</span>: <span id="subject">Subject</span></h4>
                    </div>
                    <div class="col-md-2"></div>
                    <div class="col-md-2"></div>
                    <div class="col-md-2">
                        <h4 class="d-inline p-2 bg-warning text-white">Level: <span id="level">Betrag</span></h4>
                    </div>
                </div>
                <br>
                <br>
                <div class="row">
                    <div class="col-md-1"></div>
                    <h3 id="question_text" class="col-md-9 d-block p-2 bg-primary text-white">Frage?</h3>
                    <div class="col-md-2"></div>
                </div>
                <p></p>
                <!--Antworten A und B-->
                <div class="row">
                    <div class="col-md-1"></div>
                    <button class="h3 col-md-4 d-inline p-2 bg-primary text-white" type="button" role="alert" id="answers_a" name="answers" value="A" onclick="checkAnswer(this)">
                        <label for="answers_a"><span id="answer_a">Antwort A</span></label></button>
                    <div class="col-md-1"></div>
                    <button class="h3 col-md-4 d-inline p-2 bg-primary text-white" type="button" role="alert" id="answers_b" name="answers" value="B" onclick="checkAnswer(this)">
                        <label for="answers_b"><span id="answer_b">Antwort B</span></label></button>
                        <div class="col-md-1"></div>
                    </div>
                <!--Antworten C und D-->
                <div class="row">
                    <div class="col-md-1"></div>
                    <button class="h3 col-md-4 d-inline p-2 bg-primary text-white" type="button" role="alert" id="answers_c" name="answers" value="C" onclick="checkAnswer(this)">
                        <label for="answers_c"><span id="answer_c">Antwort C</span></label></button>
                    <div class="col-md-1"></div>
                    <button class="h3 col-md-4 d-inline p-2 bg-primary text-white" type="button" role="alert" id="answers_d" name="answers" value="D" onclick="checkAnswer(this)">
                        <label for="answers_d"><span id="answer_d">Antwort D</span></label></button>
                        <div class="col-md-2"></div>
                </div>               
            </form>
        </section>
        <p></p>

        <!--display feedback-->
        <div class="row">
            <div class="col-md-1"></div>
            <!--display correct answer-->
            <section id="correct_answer" style="display: none" class="col-md-9 text-center">
                <h4 class="d-inline p-2 bg-success text-white">Gratulation, your answer is correct.</h4>
            </section>

            <!--display false answer-->
            <section id="false_answer" style="display: none" class="col-md-1">
                <h4 class="d-inline p-2 bg-danger text-white">Sorry, your answer is not correct.</h4>
            </section>
        </div>
        <p></p>
        <!--Anzeige nächste Frage-->
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-9">
                <button class="btn btn-dark .btn-circle.btn-xl" type="button" id="continue" style="display:none" onclick="
                    showQuestion();
                    hide(document.getElementById('continue'));
                    hide(document.getElementById('correct_answer'))"><h4>Next Question</h4></button>      
            </div>
        </div>
        <!--Anzeige Quiz starten; erscheint nur auf 1. Seite-->
        <p><button class="display-1" id="startQuiz" style="display:block" onclick="
                        show(document.getElementById('result'));
                        show(document.getElementById('quiz1'));
                        showQuestion();
                        hide(document.getElementById('image'));
                        hide(document.getElementById('startQuiz'))">Quiz starten</button></p>       
        <p> </p>
        <!--Anzeige nächste Frage-->
        <p></p>
        <p><button id="continue" style="display:none" onclick="
                        showQuestion();
                        hide(document.getElementById('continue'));
                        hide(document.getElementById('correct_answer'))">Nächste Frage</button></p>       
        <p> </p>
        <!--<button><a href = "index.html" title ="Start Page">Zur Startseite zurück</a></body></button>-->
        
        <!-- Ergänzung von Markus --> 
        <p></p>
        <button onclick="showNewQuestion ()">Frage aus JSON laden (JSON wird später mal von API requested)</button> <p></p>
        <p></p>
        <section id="result" style="display: none">
        <button><a href = "results.html" title ="Anzeige der aktuellen Punkte">Quiz beenden</a></body></button> <p></p>
        </section>
        <section id="congratulation" style="display:none">
        <button><a href = "congratulation.html" title ="Anzeige bei erfolgreichen Abschluss des Quiz">Gratulationsbildschirm</a></body></button>
        </section>
    </body>
</html>


