<!DOCTYPE html>

<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Quiz Page</title>
        <link rel = "stylesheet" href = "css/quizStyle.css">
        <link rel="shortcut icon" type="image/x-icon" href="media/favicon.ico">
        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <script src="js/script.js"></script>

        <!-- Bootstrap -->
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/style.css" rel="stylesheet">

        <script>
            // https://raw... = Link zum JSON-Objekt nach Spezifikation des API. Genutzt als default-Wert
            var json_url = 'https://raw.githubusercontent.com/SPRINT-Raketen/SPRINT-Quiz/main/project/frontend/src/main/officialJSONdummy.json';
            
            //Variablen zum Zwischenspeichern der Werte aus JSON
            var questionId;
            var levelId=0; //0=Startwert
            var value=123;    //entspricht Wert einer Frage -> nötig für Punkte bei Ausstieg
            var levelText;
            var subject;
            var subjectId; 
            var feedback_a;
            var feedback_b;
            var feedback_c;
            var feedback_d; 

            //generiert Anfrage an API mit Parametern Level & subject
            function buildAPIrequest (level, subjectId) {
                var baseURL = "http://localhost:80/sprintquiz/backend/src/main/sprintquiz/api/questions/question.php";
                var APIcommand = "GET "; //GET ist eh default bei fetch(). Da ich vom frontend her nur GET brauche, kann ich das weglassen
                var endpointLevel;
                var endpointSubjectId=1; //Vorläufig per default "1", weil nur Fragen aus der Kategorie 1 (="Allgemein") bestehen

                level = Number(level);
                endpointLevel=level;

                json_url=baseURL+"?level="+endpointLevel+"&subject="+endpointSubjectId;

            }

            //holt JSON-Objekt ab (vorläufig auf GitHub, später beim API)
            function getJSON (){
                console.log ("getJSON: "+json_url);
                fetch(json_url)
                .then(response => {
                    if (response.status === 200) {    // okay
                        const json_obj = response.json();   // consume json, only once possible!
                        return json_obj;    // return consumed json to second .then() 
                    } else {    // nok, so print error
                        alert(response.status.toString() + ": " + response.statusText);
                    }
                })

                .then(myJson => { // lambda to manage consumed jso
                    var parsedJSON = myJson; 

                    //05.04.21 Markus: Zur Kontrolle im browser
                    console.log ("Anzahl Datensätze: "+myJson.length);

                    //05.04.21 Markus: Wenn mehrere passende Fragen angeboten werden, wird per Zufall ausgewählt
                    var index = Math.floor((Math.random())*myJson.length);
                    parsedJSON = myJson [index];

                    //05.04.21 Markus: Zur Kontrolle im browser
                    console.log (JSON.stringify(parsedJSON));

                    //07.03.21 Markus: Ich lese aus der API-Spezifikation von oben nach unten, egal ob's Variablen oder html-Inhalte sind
                    questionId                                          =   parsedJSON.id;
                    levelId                                             =   parsedJSON.level.id;
                    value                                               =   parsedJSON.level.value;
                    levelText                                           =   parsedJSON.level.text;
                    subjectId                                           =   parsedJSON.subject.id;
                    document.getElementById("subjectText").innerHTML    =   parsedJSON.subject.text;
                    document.getElementById("question_text").innerHTML  =   parsedJSON.question;
                    $("#" + id1).text(parsedJSON.answers[0].text);
                    feedback_a                                          =   parsedJSON.answers[0].feedback;
                    $("#" + id2).text(parsedJSON.answers[1].text);
                    feedback_b                                          =   parsedJSON.answers[1].feedback;
                    $("#" + id3).text(parsedJSON.answers[2].text);
                    feedback_c                                          =   parsedJSON.answers[2].feedback;
                    $("#" + id4).text(parsedJSON.answers[3].text);
                    feedback_d                                          =   parsedJSON.answers[3].feedback;
                })
            }
        
            //REST-API-requests generieren.
            function getNewQuestion (levelId, subject){
                /*
                Markus 05.04.21: +1, damit nicht vom gleichen, sondern vom nächsthöheren Level Fragen requestet werden.
                Nur nötig, wenn +1 nirgends sonst gemacht wird!
                */
                levelId++;

                buildAPIrequest (levelId, subject);
                json_obj_global= getJSON();

                //Markus 05.04.21: folgende Funktionen sind nicht notwendig, nur zur Überprüfung
                displayCurrentValues ();
            }

            //Markus 05.04.21: nur eine Testfunktion. Kann gelöscht werden wenn alles läuft
            function displayCurrentValues (){
                document.getElementById("json_url_DISPLAY").innerHTML   =   json_url;
                document.getElementById("Platzhalter_subject").innerHTML=   subject;
                document.getElementById("Platzhalter_levelId").innerHTML=   levelId;
            }
        </script>
        
        <script src="js/quiz.js"></script>
    </head>

    <body>
        <!--Zeile mit Quiz beenden-->
        <div class="row">
            <div class="col-md-6" id="subject_line" style="display: none">
                <h6 class="d-inline p-2 bg-dark text-white">Thema <span id="subjectId">0</span>: <span id="subjectText">Subject</span></h6>
            </div>
            <div class="col-md-4"></div>
            <div class="col-md-2">
                <section id="result" style="display: none">
                    <button class="btn btn-dark"><a href = "results.html" title ="Anzeige der aktuellen Punkte">Quiz beenden</a></button>
                </section>
            </div>
        </div>
        <br>
        <!--Bild auf erster Seite-->
        <div id="image" style="display:block" class="text-center">
            <img src = "media/millionen-quiz.png" width = "200" height="191" alt = "SPRINT-Quiz">
        </div>

        <!--Section mit Frage und Antworten-->
        <section id="quiz1" style="display: none">
            <form id="quiz" name="quiz" method="" action="">
                <div class="row">
                    <div class="col-md-3">
                        <h4 class="d-inline p-2 bg-warning text-white">Level <span id="levelId">levelId</span>: <span id="levelValue">Betrag</span></h4>
                    </div>
                    <!--<div class="col-md-4">
                        <h4 class="d-inline p-2 bg-warning text-white">Frage <span id="qno">0</span></h4>
                    </div>
                    <div class="col-md-2"></div>
                    <div class="col-md-2"></div>
                    <div class="col-md-2">
                        <h4 class="d-inline p-2 bg-warning text-white">Level <span id="levelId">levelId</span>: <span id="levelValue">Betrag</span></h4>
                    </div>-->
                </div>
                <br>
                <br>
                <div class="row">
                    <div class="col-md-10">
                        <div class="row">
                            <div class="col-md-1"></div>
                            <h3 id="question_text" class="col-md-11 d-block p-2 btn-primary">Frage?</h3>
                        </div>
                        <p></p>
                        <!--Antworten A und B-->
                        <div class="row">
                            <div class="col-md-1"></div>

                            <button class="h3 col-md-5 d-inline p-2 btn btn-primary text-white" type="button" role="alert" id="answers_a" name="answers" value="A" 
                                onclick="deselectAnswer(this); checkAnswer(this)">
                                <h3><label for="answers_a"><span id="answer_a">Antwort A</span></label></h3></button>

                            <div class="col-md-1"> </div>

                            <button class="h3 col-md-5 d-inline p-2 btn btn-primary text-white" type="button" role="alert" id="answers_b" name="answers" value="B" 
                                onclick="deselectAnswer(this); checkAnswer(this)">
                                <h3><label for="answers_b"><span id="answer_b">Antwort B</span></h3></label></button>
                            </div>
                        <!--Antworten C und D-->
                        <div class="row">
                            <div class="col-md-1"></div>

                            <button class="h3 col-md-5 d-inline p-2 btn btn-primary text-white" type="button" role="alert" id="answers_c" name="answers" value="C" 
                                onclick="deselectAnswer(this); checkAnswer(this)">
                                <h3><label for="answers_c"><span id="answer_c">Antwort C</span></label></h3></button>

                            <div class="col-md-1"></div>

                            <button class="h3 col-md-5 d-inline p-2 btn btn-primary text-white" type="button" role="alert" id="answers_d" name="answers" value="D" 
                                onclick="deselectAnswer(this); checkAnswer(this)">
                                <h3><label for="answers_d"><span id="answer_d">Antwort D</span></label></h3></button>
                        </div> 
                    </div>
                    <div class="col-md-2">
                        <div class="row">
                            <div class="col-3"></div>
                            <div class="h6 col-9 d-block p-2 alert-warning text-center" id="level6">1 000 000</div>
                         </div>
                         <div class="row">
                            <div class="col-3"></div>
                            <div class="h6 col-9 d-block p-2 alert-warning text-center" id="level5">100 000</div>
                         </div>
                         <div class="row">
                            <div class="col-3"></div>
                            <div class="h6 col-9 d-block p-2 alert-warning text-center" id="level4">10 000</div>
                         </div>
                         <div class="row">
                            <div class="col-3"></div>
                            <div class="h6 col-9 d-block p-2 alert-warning text-center" id="level3">1000</div>
                         </div>
                         <div class="row">
                            <div class="col-3"></div>
                            <div class="h6 col-9 d-block p-2 alert-warning text-center" id="level2">100</div>
                         </div>
                         <div class="row">
                            <div class="col-3"></div>
                            <div class="h6 col-9 d-block p-2 bn-warning text-center" id="level1">50</div>
                         </div>
                    </div>
                </div>
                
                <!-- Start Ergänzung von Markus. Stand 24.04. Zum Test des REST API. Kann gelöscht werden. --> 
                <p></p>
                <button onclick="getNewQuestion (levelId, subject)">Frage aus JSON laden (JSON wird später mal von API requested)</button> <p></p>
                <p></p>
                
                <div class="row">
                    <div class="col-md-1"></div>  
                    <h4 id="json_url_DISPLAY" class="col-md-9 d-block p-2 bg-primary text-yellow">Platzhalter Anzeige link REST API request</h3> 
                    <div class="col-md-2"></div>
                </div> 
                
                <div class="row">
                    <div class="col-md-1"></div>
                    <h4 id="Platzhalter_levelId" class="col-md-9 d-block p-2 bg-primary text-yellow">Platzhalter_levelId</h3>
                    <div class="col-md-2"></div>
                </div>

                <div class="row">
                    <div class="col-md-1"></div>
                    <h4 id="Platzhalter_subject" class="col-md-9 d-block p-2 bg-primary text-yellow">Platzhalter_subject</h3>
                    <div class="col-md-2"></div>
                </div>
                <!-- Ende Ergänzung von Markus. -->
            </form>
        </section>
        <p></p>

        <!--display feedback-->
        <div class="row">
            <div class="col-md-1"></div>
            <!--display correct answer-->
            <div id="correct_answer" style="display: none" class="col-md-9 text-center p-2 bg-success text-white">
                <h4>Gratulation! <scan class="feedbacks"> Individuelles Feedback</scan></h4>
            </div>

            <!--display false answer-->
            <div id="false_answer" style="display: none" class="col-md-9 text-center p-2 bg-danger text-white">
                <h4>Schade! <scan class="feedbacks"> Individuelles Feedback</scan></h4>
            </div>
            <div class="col-md-1"></div>
        </div>
        <p></p>
        <!--Anzeige nächste Frage-->
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-9">
                <button class="btn btn-dark .btn-circle.btn-xl" type="button" id="continue" style="display:none" onclick="
                    /* 
                    05.04.21: Ergänzung von Markus: 
                    Klick auf 'zur nächsten Frage' soll im Hintergrund REST-API-request auslösen
                    */
                    getNewQuestion (levelId, subject);
                    
                    deselectLevel();
                    selectLevel();
                    shuffleAnswers();
                    showQuestion();
                    selectAnswer(document.getElementById('answers_a'));
                    selectAnswer(document.getElementById('answers_b'));
                    selectAnswer(document.getElementById('answers_c'));
                    selectAnswer(document.getElementById('answers_d'));
                    hide(document.getElementById('continue'));
                    hide(document.getElementById('correct_answer'))"><h4>Zur nächsten Frage</h4></button>      
            </div>
        </div>
        <!--Anzeige Quiz starten; erscheint nur auf 1. Seite-->
        <p><button class="display-1" id="startQuiz" style="display:block" onclick="
            show(document.getElementById('subject_line'));
            show(document.getElementById('result'));
            show(document.getElementById('quiz1'));

            //05.04.21 Markus: Klick auf 'zur nächsten Frage' soll im Hintergrund REST-API-request auslösen
            getNewQuestion (levelId, subject);

            selectLevel();
            shuffleAnswers();
            showQuestion();
            hide(document.getElementById('image'));
            hide(document.getElementById('impressum'));
            hide(document.getElementById('startQuiz'))">Quiz starten</button></p>       
        <p> </p>
        
        <!--Anzeige Impressmum; erscheint nur auf 1. Seite-->
        <div class="row">
            <div class="col-md-3">
                <button class="btn btn-dark" id="impressum" style="display:block">                                            
                <a href = "impressum.html">Impressum</a></button></div>      
        </div>
        <!--Anzeige nächste Frage-->
        <!--<p></p>
        <p><button id="continue" style="display:none" onclick="
                        deselectLevel();
                        showQuestion();
                        hide(document.getElementById('continue'));
                        hide(document.getElementById('correct_answer'))">Nächste Frage</button></p>       
        <p> </p>-->
        <!--<button><a href = "index.html" title ="Start Page">Zur Startseite zurück</a></body></button>-->
        
        <p> </p>
        <!--<button><a href = "results.html" title ="Anzeige der aktuellen Punkte">Quiz beenden</a></body></button> <p></p>-->
        </section>
        <section id="congratulation" style="display:none">
        <button><a href = "congratulation.html" title ="Anzeige bei erfolgreichen Abschluss des Quiz">Gratulationsbildschirm</a></body></button>
        </section>
        <!--Möglichkeit, das Resultat anzuschauen und ein neues Quiz zu starten-->
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-9">
                <button class="btn btn-dark .btn-circle.btn-xl" id="newQuiz" style="display:none">                                            
                <a href = "results.html">Weiter</a></button></div>      
        </div>

        <!--06.04.21 Markus: Übergabe des aktuellen Punktestandes von playQuiz.html an results.html
        START SENDEN-->
            <!--https://stackoverflow.com/questions/3724106/how-to-exchange-variables-between-two-html-pages-->
            <a href='results.html?points=value'>send points</a>
        <!--06.04.21 Markus: Übergabe des aktuellen Punktestandes von playQuiz.html an results.html
        ENDE SENDEN-->
    </body>
</html>


